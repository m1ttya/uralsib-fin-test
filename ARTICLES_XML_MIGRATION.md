# Миграция статей на XML формат

## Что изменилось

### Старый функционал (до миграции)
- Статьи хранились как файлы в `backend/uploads/articles/`
- Поддерживались форматы: DOCX, HTML, PDF
- Файлы оставались на сервере
- Метаданные в `articles_meta.json`

### Новый функционал (после миграции)
- Статьи хранятся в XML формате в `backend/data/articles.json`
- Загруженные PDF/DOCX конвертируются в XML и удаляются
- Встроенный WYSIWYG редактор
- Система статусов (draft/published)
- Теги и метаданные

## Структура данных

### XML формат статей
```xml
<?xml version="1.0" encoding="UTF-8"?>
<article>
  <paragraph>Обычный текст</paragraph>
  <heading level="1">Заголовок</heading>
  <bold>Жирный текст</bold>
  <italic>Курсив</italic>
  <list type="unordered">
    <item>Элемент списка</item>
  </list>
</article>
```

### JSON структура
```json
{
  "articles": [
    {
      "id": "uuid",
      "title": "Заголовок статьи",
      "content": "XML содержимое",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z",
      "author": "admin",
      "tags": ["финансы", "инвестиции"],
      "status": "published"
    }
  ]
}
```

## API Endpoints

### Публичные
- `GET /api/articles` - список опубликованных статей
- `GET /api/articles/:id` - содержимое статьи

### Админские
- `GET /api/articles/admin/list` - все статьи для админа
- `GET /api/articles/admin/:id` - статья для редактирования
- `POST /api/articles/admin/create` - создать статью
- `PUT /api/articles/admin/:id` - обновить статью
- `DELETE /api/articles/admin/:id` - удалить статью
- `POST /api/articles/admin/upload` - загрузить и конвертировать файл

## Установка зависимостей

```bash
cd backend
chmod +x install_dependencies.sh
./install_dependencies.sh
```

Или вручную:
```bash
npm install uuid mammoth multer
npm install --save-dev @types/uuid @types/multer
```

## Возможности редактора

### Форматирование текста
- **Жирный**, *курсив*, подчеркнутый
- Заголовки H1-H3, параграфы
- Списки (маркированные, нумерованные)
- Выравнивание (лево, центр, право)
- Ссылки

### Загрузка файлов
- **DOCX**: полная конвертация в XML через mammoth
- **PDF**: базовая поддержка (требует доработки)
- Файлы удаляются после конвертации

## Миграция существующих статей

Для миграции старых статей выполните:

1. Создайте пустой `backend/data/articles.json`:
```json
{
  "articles": []
}
```

2. В админке используйте функцию "Загрузить файл" для каждой существующей статьи

3. Отредактируйте контент в встроенном редакторе

4. Удалите старые файлы из `backend/uploads/articles/`

## Преимущества нового подхода

### Для разработчиков
- Единый формат хранения (XML)
- Простая структура данных
- Легкая интеграция с поиском
- Возможность программной обработки

### Для администраторов
- WYSIWYG редактор
- Система статусов и тегов
- Предпросмотр изменений
- Упрощенная загрузка файлов

### Для пользователей
- Быстрая загрузка (нет файлов)
- Консистентное отображение
- Поддержка тегов
- Адаптивный дизайн

## Ограничения и планы развития

### Текущие ограничения
- PDF конвертация базовая (только текст)
- Нет поддержки изображений в статьях
- Простой редактор (нет таблиц, сложного форматирования)

### Планы развития
- Улучшение PDF конвертации (OCR)
- Поддержка изображений и медиа
- Расширенный редактор (таблицы, встраивание)
- Система комментариев
- Поиск по контенту статей
- SEO метаданные